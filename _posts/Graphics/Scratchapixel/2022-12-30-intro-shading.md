---
title: Introduction to Shading
date: 2022-12-30 23:38 +0800
categories: [Graphics, Scratchpixel]
media_subpath: /assets/img/Graphics/Scratchapixel/
math: true
---

### 1 What is Shading: Light-Matter Interaction

在本篇博客中，我们会首次了解到“shading”的含义，以及影响物体外观的因素，例如**光线强度**、**光线方向**、**物体表面相对于光源的朝向**、**物体的颜色**等等。当我们理解了这些基础概念后，我们将会探讨一些用于计算着色的基本技巧，并在后续探讨更深层次的东西，例如反射与折射。

#### 1.1 Intro to Shading

正如我们在之前的章节中所提到的，渲染本质上可以划分为两个阶段**：可见性**与**着色**。解决可见性问题上，我们介绍了两种技巧，分别是**光栅化**与**光线追踪**。从本篇博客开始，我们将专注于渲染过程的第二阶段，也就是着色。这个话题涵盖了众多方面，所以，我们不妨先从最基础的着色知识开始。

#### 1.2 What is Shading?

首先，我们了解到渲**染是从给定视角在计算机中重新还原场景中物体的形状、可见性以及外观的过程**。前两个方面我们可以通过光栅化/光线追踪解决，那么**着色就是计算场景中物体颜色的过程**。给定视角在着色过程中起着重要的作用，因为物体的外观在不同视角下可能是不同的。同时，外观还会受到很多其他因素的影响，简单来说，**外观很大程度上取决于光与物质之间的交互**。

#### 1.3 Setting Up Terminology

在Photorealistic Rendering中，物体的外观在本质上是两个主要因素的副产物：**光照**与**物体的属性**。光线在可见性过程中就扮演着重要的角色；没有光，物体就不可见。并且通常情况下，光线越强，物体就越明亮。而物体的属性可以大致分为两类：

- **表面的几何属性**（例如朝向性）
- **影响光线与物体交互过程的属性**（例如物体的颜色）

当我们看到“某个物体”时，我们实际上看到是物体表面所反射的光线：光线被光源发出，到达物体表面，此时物体会将部分光线反射到观察者所在的方向。在着色中，我们称这种光线为**直接光照**，如下图所示：

![](shad-reflected-light1.png)

当然，物体所反射的光线也可以到达其他物体的表面，经过若干次反射后，最终进入人眼，我们将这种现象称为**间接光照**。

![](shad-reflected-light3.png)

#### 1.4 Light-Matter Interaction and the Essential Components Of Shading

上一小节中，我们了解到：**我们所感知的并非物体本身，而是物体表面所反射的光线** 。我们在前面也提到过，**表面相对于光源的朝向对于反射的光量有着重要的影响**。在生活中我们不难观察到，能将光线反射回光源的表面是最明亮的部分。

由此我们在着色中引入以下重要的量：**着色点$P$**，**表面法向量$N$**，从$P$指向光源位置的**光线方向$L$**，以及观察方向$V$。

在我们深入研究光线是如何被反射之前，我们首先来考虑光线反射的方向。我们通常使用$\omega_i$来表示入射角，用$\omega_o$表示反射角度。对于完美镜面反射的物体来说，反射定律告诉我们这样一个结论：**反射角等于入射角**。并且利用几何知识，我们可以轻松根据$N$与$L$计算出反射角度。

然而，现实中的绝大多数物体都并非是完美镜面反射的。在CG中，我们用**diffuse**或**Lambertian**来描述不光滑表面的这种性质。diffuse表面与光泽表面区别在于，粗糙表面类似于“破损”的镜面。它们的表面类似于很多朝向随机的微小完美镜面所构成的集合，如下图所示：

![](shad-rough.png)

结果就是，光线会被散射到各个不同的方向上，而反射方向则取决于这些微小表面朝向的差异性。进而，反射的图像就会呈现出模糊的效果。换句话说，**如果一个物体表面上的反射是模糊的，那就意味着该表面是粗糙的，它倾向于将光线反射到各个不同的方向上，而非镜面条件下一个单一的反射方向**。

![](shad-roughness1.gif)

漫反射材质通常会被认为是完美镜面的对立面，并且我们会自然而然地将材质的漫反射性与粗糙度相关联，**但实际上，漫反射性质的本质原因并非来自粗糙度**。漫反射材质通常具有复杂的内部结构，**这种结构会将入射光线“困”在材质内部，光线在离开物体表面之前，会在其内部多次反射**。**这种多次内反射最终会导致光线离开的角度与入射方向毫无关联**。在CG中，我们认为**光线离开的方向是随机**的。比方说，如果有100束光线以相同的入射角度到达着色点$P$周围的一小部分区域，那么最终的结果是小于100束的光线会以随机的方向离开表面，因为部分光线会因多次内反射而被材质吸收。

由于我们上述的这种性质，**漫反射物体会被视为在以$P$为圆心，$N$为朝向的半球的所有方向上均匀地反射入射光线**。如下图所示：

![](shad-light-beam5.png)

**由于漫反射物体向所有方向均匀地反射光线，表面的亮度是与观察方向无关的，光滑表面的反射是view-dependent**。

最后，我们还需要讨论一下着色的另一个方面：为什么物体具有各种各样的颜色，以及我们如何模拟不同的颜色。“白色”的光线是由可见光谱中的所有颜色组成的，而**当白光到达物体表面时，部分颜色会被吸收，部分颜色会被反射**。例如，橙色的水果会吸收绝大部分蓝光，而反射红光与绿光，经过混合就呈现出了橙色。**这种现象可以量化为不同颜色的反射光与入射光的比率，我们将这种概念称为albedo反照率。在我们例子中，以RGB颜色系统表示的话，红绿蓝的反照率分别为0.9，0.6，0.1。**

---

###  2 Normals, Vertex Normals and Facing Ratio

