---
title: 2.1 Monte Carlo Basics
date: 2024-07-03 09:40 +0800
categories: [Graphics, Physically Based Rendering]
media_subpath: /assets/img/Graphics/PhysicallyBasedRendering/
math: true
---

由于蒙特卡洛积分是基于随机性的算法，所以在本章的开始，我们先回顾一些概率学和统计学的相关知识。

### 2.1.1 Background and Probability Review

一个随机变量$X$是通过某种随机过程选择的值，我们通常用大写字母表示一个随机变量，对于某些特殊的随机变量我们会依照惯例使用希腊字母表示。随机变量总是从某个域中选取，该域可以是离散的，也可以连续的。对一个随机变量$X$应用函数$f$会生成一个新的随机变量$Y=f(X)$

例如，掷骰子的结果是一个从一组事件$X_i \in \lbrace 1,2,3,4,5,6 \rbrace $抽样的随机变量。每个事件的概率均等，且所有事件的概率总和为1。当随机变量对于其他所有潜在值具有的相同的概率时，我们称该随机变量是均分分布的。给出离散变量概率的函数$p(X)$被称为概率质量函数PMF，对于掷骰子这个例子，我们有$P(X)=\frac{1}{6}$。

---

如果一个随机变量的概率不会影响另一个随机变量的概率，那我们说这两个随机变量是相互独立的。此时，两个变量的联合概率*joint probablity* $p(X, Y)$由它们概率的乘积表示，即$P(X, Y)=p(X)p(Y)$。

对于相互依赖的随机变量，一个变量的概率会影响另一个变量的概率。考虑一个装有若干个黑球和若干个白球的袋子。如果我们从袋子里随机选出两个球，第二个球是白球的概率会受到第一个球颜色的影响，因为第一个球的选择改变了袋子里剩余某种类型球的数量。我们称第二个球的概率以第一个球的选择为条件。

在本书后续的内容中，随机变量的概率通常会以许多值为条件，比如，在选择采样光照的光源时，`BVHLightSampler`会考虑到着色点的位置与法线，因此光源的选择是以它们为条件的。

---

*canonical uniform random variable*， 这是一种特别重要的随机变量，记为$\zeta$，它的值域是$[0,1)$，并且每个值都有相同的概率。它具备两个重要的性质，首先对于计算机程序来说，$\zeta$很容易生成，此外，我们可以将$\zeta$映射到离散随机变量上，使用下面这个公式：

$$
\sum_{j=1}^{i-1}p_j \le \zeta < \sum_{j=1}^{i}p_j
$$


其中，$p_j$是一系列满足$\sum_jp_j=1$的概率值。让我们来举一个例子进一步说明。在光照计算中，我们可以定义出每个光源的采样概率是：


$$
p_i=\frac{\Phi _i}{\sum_j \Phi_j}
$$


其中，$\Phi _i$表示第$i$个光源的功率，$\sum_j \Phi_j$表示所有光源的总功率。这样一来，给定一个均匀随机变量$\zeta$，我们可以根据光源的功率来决定采样哪个光源，从而实现基于功率的光源采样

---

一个随机变量的累计分布函数CMF $P(X)$表示变量分布中该值小于或等于某个值的概率：


$$
P(X) = Pr\lbrace X \le x \rbrace
$$


还是以掷骰子为例，$P(2)=\frac{1}{3}$表示点数小于等于2的概率为$\frac{1}{3}$

---

PDF描述了随机变量取某个特定值的相对概率，离散随机变量的PMF的一种连续性的形式。此外，PDF $p(x)$是随机变量CDF的导数。对于均匀的随机变量来说，PDF $p(x)$是一个常数。如果我们通过导数来理解，是因为均匀变量的CMF的斜率是固定的。我们通过公式将PDF与CMF的关系表示出来:


$$
p(x) = \frac{dP(x)}{dx}
$$




PDF具有两个重要的性质：

- **非负性**：$p(x) \ge 0$
- **归一化**：$p(x)$在其整个定义域上的积分等于1，也就是总概率为1

要计算随机变量在给定区间$[a, b]$上的概率，需要在该区间上对PDF积分：


$$
Pr\lbrace x \in [a, b] \rbrace = \int_a^b p(x)dx = P(b)-P(a)
$$

### 2.1.2 Expected Values

一个函数$f$的期望值$E_p[f(x)]$被定义为函数$f$在某个值分布$p(x)$下的平均值，数学表达式为：
$$
E_p[f(x)] = \int_Df(x)p(x)dx
$$


其中：

- $D$是函数的定义域
- $f(x)$是需要计算期望值的函数
- $p(x)$是概率密度函数，描述了$x$在$D$上的分布情况

我们来举一个例子，要求余弦函数$cos(x)$在区间$[0, \pi]$上的期望值，其中$p(x)$是均匀分布的，也就是说$x$在$[0, \pi]$上的每个点的概率密度相同，即:


$$
p(x) = \frac{1}{\pi}
$$


所以，余弦函数$cos(x)$在区间$[0, \pi]$上的期望值的计算如下：


$$
E[cos(x)]=\int_0^{\pi}cos(x)\cdot \frac{1}{\pi}dx=\frac{1}{\pi}\int_0^{\pi}cos(x)\cdot dx = \frac{1}{\pi}(sin \pi-sin0) = 0
$$


此外，期望值有一些重要的形式，这些性质 直接来源于期望值的定义：

1. **线性性质：**
   $$
   E[af(x)]=aE[f(x)]
   $$

2. **加法性质：**
   $$
   E\Big[\sum_{i=1}^nf(X_i)\Big]=\sum_{i=1}^nE[f(X_i)]
   $$

### 2.1.3 The Monte Carlo Estimator

现在我们可以来定义蒙特卡洛估值器了，它可以用来估计一个任意积分的值。假设我们想要计算一个一维的积分$\int_a^bf(x)dx$，并且给定了一组独立的均匀随机变量$X_i \in [a, b]$，那么蒙特卡洛估值器就可以geichu
